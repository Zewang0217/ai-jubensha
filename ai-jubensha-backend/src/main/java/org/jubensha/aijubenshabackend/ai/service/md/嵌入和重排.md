# åµŒå…¥å‡½æ•°æ¦‚è¿°Compatible with Milvus 2.6.x | Milvus æ–‡æ¡£

[ğŸš€ Zilliz äº‘ï¼šå…¨é¢ç®¡ç† Milvus - é€Ÿåº¦å¿« 10 å€ã€‚é›¶çƒ¦æ¼ã€‚ä¸“ä¸ºäººå·¥æ™ºèƒ½æ‰“é€ ã€‚ç«‹å³å…è´¹è¯•ç”¨ â†’](https://cloud.zilliz.com/signup?utm_source=milvusio&utm_medium=referral&utm_campaign=milvus_top_banner&utm_content=docs/zh/embedding-function-overview.md)

[![Milvus](/images/layout/milvus-logo.svg)](/zh)

[![Zilliz](/images/layout/zilliz-logo.svg)](https://zilliz.com/)

-   ä¸ºä»€ä¹ˆé€‰æ‹© Milvus
    
    -   [ä»€ä¹ˆæ˜¯ Milvus](/zh/intro)
    -   [ä½¿ç”¨æ¡ˆä¾‹](/zh/use-cases)
    
-   [æ–‡æ¡£](/docs/zh)
-   æ•™ç¨‹
    
    -   [è®­ç»ƒè¥](/zh/bootcamp)
    -   [æ¼”ç¤º](/zh/milvus-demos)
    -   [è§†é¢‘](https://www.youtube.com/c/MilvusVectorDatabase)
    
-   å·¥å…·
    
    -   [Attu](https://github.com/zilliztech/attu)
    -   [Milvus CLI](https://github.com/zilliztech/milvus_cli)
    -   [é…ç½®å·¥å…·](/zh/tools/sizing)
    -   [Milvus å¤‡ä»½](https://github.com/zilliztech/milvus-backup)
    -   [VTS](https://github.com/zilliztech/vts)
    -   [æ·±åº¦æœç´¢å™¨](https://github.com/zilliztech/deep-searcher)
    -   [Claude Context](https://github.com/zilliztech/claude-context)
    
-   [åšå®¢](/zh/blog)
-   ç¤¾åŒº
    
    -   [ç±³å°”æ²ƒæ–¯åŠå…¬æ—¶é—´](https://meetings.hubspot.com/chloe-williams1/milvus-office-hour?uuid=4cb203e5-482a-47e0-90a6-7acc511d61f4)
    -   [æ¾å¼›](https://milvus.io/slack )
    -   [Discord](https://milvus.io/discord)
    -   [GitHub](https://github.com/milvus-io/milvus/discussions)
    -   [æ›´å¤šç¤¾åŒº](/zh/community)
    

ç®€ä½“ä¸­æ–‡

[Star42.6K](https://github.com/milvus-io/milvus)[é¢„çº¦æ¼”ç¤º](/zh/contact)[

å¼€å§‹ä½¿ç”¨

](https://cloud.zilliz.com/signup?utm_source=milvusio&utm_medium=referral&utm_campaign=milvus_nav_right&utm_content=docs/zh/embedding-function-overview.md)

[![Milvus](/images/layout/milvus-logo.svg)](/zh)

[![Zilliz](/images/layout/zilliz-logo.svg)](https://zilliz.com/)

ç®€ä½“ä¸­æ–‡

æœç´¢K

[é¦–é¡µ](/docs/zh)

[v2.6.x](/docs/embedding-function-overview.md)

â€‹

-   å…³äº Milvus
    
-   å¼€å§‹
    
-   æ¦‚å¿µ
    
-   ç”¨æˆ·æŒ‡å—
    
    -   [æ•°æ®åº“](/docs/zh/manage_databases.md)
        
    -   Collections
        
    -   Schema å’Œæ•°æ®å­—æ®µ
        
    -   æ’å…¥å’Œåˆ é™¤
        
    -   ç´¢å¼•
        
    -   æœç´¢
        
    -   Embeddings &amp; Rerankers
        
        -   åµŒå…¥åŠŸèƒ½
            
            -   [Embeddings åŠŸèƒ½æ¦‚è¿°](/docs/zh/embedding-function-overview.md)
                
            -   [OpenAI](/docs/zh/openai.md)
                
            -   [Azure OpenAI](/docs/zh/azure-openai.md)
                
            -   [DashScope](/docs/zh/dashscope.md)
                
            -   [åŸºå²©](/docs/zh/bedrock.md)
                
            -   [é¡¶ç‚¹äººå·¥æ™ºèƒ½](/docs/zh/vertex-ai.md)
                
            -   [Voyage äººå·¥æ™ºèƒ½](/docs/zh/voyage-ai.md)
                
            -   [Cohere](/docs/zh/cohere.md)
                
            -   [SiliconFLow](/docs/zh/siliconflow.md)
                
            -   [æ‹¥æŠ±è„¸ TEI](/docs/zh/hugging-face-tei.md)
                
            
        -   Rerankers åŠŸèƒ½
            
        
    -   å­˜å‚¨ä¼˜åŒ–
        
    
-   æ•°æ®å¯¼å…¥
    
-   ç®¡ç†æŒ‡å—
    
-   å·¥å…·
    
-   é›†æˆ
    
-   æ•™ç¨‹
    
-   å¸¸è§é—®é¢˜
    
-   API Reference
    

-   [é¦–é¡µ](/zh)
-   [æ–‡æ¡£](/docs/zh)
-   ç”¨æˆ·æŒ‡å—
    
-   Embeddings &amp; Rerankers
    
-   åµŒå…¥åŠŸèƒ½
    
-   Embeddings åŠŸèƒ½æ¦‚è¿°
    

# åµŒå…¥å‡½æ•°æ¦‚è¿°Compatible with Milvus 2.6.x

é€šè¿‡ Milvus çš„ Function æ¨¡å—ï¼Œæ‚¨å¯ä»¥è‡ªåŠ¨è°ƒç”¨å¤–éƒ¨åµŒå…¥æœåŠ¡æä¾›å•†ï¼ˆå¦‚ OpenAIã€AWS Bedrockã€Google Vertex AI ç­‰ï¼‰ï¼Œå°†åŸå§‹æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºå‘é‡åµŒå…¥ã€‚æœ‰äº† Function æ¨¡å—ï¼Œæ‚¨å°±ä¸å†éœ€è¦æ‰‹åŠ¨ä¸åµŒå…¥å¼ API æ¥å£--Milvus ä¼šå¤„ç†å‘æä¾›å•†å‘é€è¯·æ±‚ã€æ¥æ”¶åµŒå…¥å¼æ•°æ®å¹¶å°†å…¶å­˜å‚¨åˆ°æ‚¨çš„ Collections ä¸­çš„æ•´ä¸ªè¿‡ç¨‹ã€‚å¯¹äºè¯­ä¹‰æœç´¢ï¼Œæ‚¨åªéœ€è¦æä¾›åŸå§‹æŸ¥è¯¢æ•°æ®ï¼Œè€Œä¸éœ€è¦æŸ¥è¯¢å‘é‡ã€‚Milvus ä½¿ç”¨ä¸æ‚¨ç”¨äºæ¥æ”¶çš„ç›¸åŒæ¨¡å‹ç”ŸæˆæŸ¥è¯¢å‘é‡ï¼Œå°†å…¶ä¸å­˜å‚¨çš„å‘é‡è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶è¿”å›æœ€ç›¸å…³çš„ç»“æœã€‚

## é™åˆ¶

-   åŠŸèƒ½æ¨¡å—åµŒå…¥çš„ä»»ä½•è¾“å…¥å­—æ®µå¿…é¡»å§‹ç»ˆåŒ…å«ä¸€ä¸ªå€¼ï¼›å¦‚æœæä¾›çš„æ˜¯ç©ºå€¼ï¼Œæ¨¡å—ä¼šå‡ºé”™ã€‚
    
-   Function æ¨¡å—åªå¤„ç† Collections Schema ä¸­æ˜ç¡®å®šä¹‰çš„å­—æ®µï¼›ä¸ä¼šç”ŸæˆåŠ¨æ€å­—æ®µçš„åµŒå…¥ã€‚
    
-   è¦åµŒå…¥çš„è¾“å…¥å­—æ®µå¿…é¡»æ˜¯`VARCHAR` ç±»å‹ã€‚
    
-   Function æ¨¡å—å¯å°†è¾“å…¥å­—æ®µåµŒå…¥åˆ°ä»¥ä¸‹åœ°å€ï¼š
    
    -   `FLOAT_VECTOR`
        
    -   `INT8_VECTOR`
        
    
    ä¸æ”¯æŒè½¬æ¢ä¸º`BINARY_VECTOR` ã€`FLOAT16_VECTOR` æˆ–`BFLOAT16_VECTOR` ã€‚
    

## æ”¯æŒçš„åµŒå…¥æœåŠ¡æä¾›å•†

æä¾›å•†

å…¸å‹æ¨¡å‹

Embeddings ç±»å‹

éªŒè¯æ–¹æ³•

[OpenAI](/docs/zh/openai.md)

text-embedding-3-\*

`FLOAT_VECTOR`

API å¯†é’¥

[Azure OpenAI](/docs/zh/azure-openai.md)

åŸºäºéƒ¨ç½²

`FLOAT_VECTOR`

API å¯†é’¥

[DashScope](/docs/zh/dashscope.md)

text-embedding-v3

`FLOAT_VECTOR`

API å¯†é’¥

[åŸºå²©](/docs/zh/bedrock.md)

Amazon.titan-embed-text-v2

`FLOAT_VECTOR`

AK/SK å¯¹

[é¡¶ç‚¹äººå·¥æ™ºèƒ½](/docs/zh/vertex-ai.md)

text-embedding-005

`FLOAT_VECTOR`

GCP æœåŠ¡å¸æˆ· JSON å‡­è¯

[Voyage AI](/docs/zh/voyage-ai.md)

Voyage-3, Voyage-lite-02

`FLOAT_VECTOR` /`INT8_VECTOR`

API å¯†é’¥

[åµŒå…¥](/docs/zh/cohere.md)

embed-english-v3.0

`FLOAT_VECTOR` /`INT8_VECTOR`

API å¯†é’¥

[SiliconFlow](/docs/zh/siliconflow.md)

BAAI/bge-large-zh-v1.5

`FLOAT_VECTOR`

API å¯†é’¥

[Hugging Face](/docs/zh/hugging-face-tei.md)

ä»»ä½• TEI æœåŠ¡çš„æ¨¡å‹

`FLOAT_VECTOR`

å¯é€‰çš„ API å¯†é’¥

## å·¥ä½œåŸç†

ä¸‹å›¾æ˜¾ç¤ºäº†è¯¥åŠŸèƒ½åœ¨ Milvus ä¸­çš„å·¥ä½œåŸç†ã€‚

1.  **è¾“å…¥æ–‡æœ¬**ï¼šç”¨æˆ·å°†åŸå§‹æ•°æ®ï¼ˆå¦‚æ–‡æ¡£ï¼‰è¾“å…¥ Milvusã€‚
    
2.  **ç”Ÿæˆ Embeddings**ï¼šMilvus ä¸­çš„ Function æ¨¡å—ä¼šè‡ªåŠ¨è°ƒç”¨é…ç½®çš„æ¨¡å‹æä¾›ç¨‹åºï¼Œå°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºå‘é‡åµŒå…¥ã€‚
    
3.  **å­˜å‚¨åµŒå…¥**ï¼šç”Ÿæˆçš„åµŒå…¥ä¼šå­˜å‚¨åœ¨ Milvus Collections ä¸­æ˜ç¡®å®šä¹‰çš„å‘é‡å­—æ®µä¸­ã€‚
    
4.  **æŸ¥è¯¢æ–‡æœ¬**ï¼šç”¨æˆ·å‘ Milvus æäº¤æ–‡æœ¬æŸ¥è¯¢ã€‚
    
5.  **è¯­ä¹‰æœç´¢**ï¼šMilvus åœ¨å†…éƒ¨å°†æŸ¥è¯¢è½¬æ¢ä¸ºå‘é‡åµŒå…¥ï¼Œæ ¹æ®å­˜å‚¨çš„åµŒå…¥è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼Œå¹¶æ£€ç´¢ç›¸å…³ç»“æœã€‚
    
6.  **è¿”å›ç»“æœ**ï¼šMilvus å‘åº”ç”¨ç¨‹åºè¿”å›åŒ¹é…åº¦æœ€é«˜çš„ç»“æœã€‚
    

 ![Embedding Function Overview](/docs/v2.6.x/assets/embedding-function-overview.png)Embeddings åŠŸèƒ½æ¦‚è¿°

## é…ç½®å‡­è¯

åœ¨ä¸ Milvus ä¸€èµ·ä½¿ç”¨åµŒå…¥å‡½æ•°ä¹‹å‰ï¼Œè¯·é…ç½®åµŒå…¥æœåŠ¡å‡­æ®ä»¥ä¾¿ Milvus è®¿é—®ã€‚

Milvus å¯é€šè¿‡ä¸¤ç§æ–¹å¼æä¾›åµŒå…¥æœåŠ¡å‡­è¯ï¼š

-   **é…ç½®æ–‡ä»¶**(`milvus.yaml`)ï¼š
    
    æœ¬ä¸»é¢˜ä¸­çš„ç¤ºä¾‹æ¼”ç¤ºäº†ä½¿ç”¨`milvus.yaml` çš„**æ¨èè®¾ç½®**ã€‚
    
-   **ç¯å¢ƒå˜é‡**ï¼š
    
    æœ‰å…³é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®å‡­æ®çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…åµŒå…¥æœåŠ¡æä¾›å•†çš„æ–‡æ¡£ï¼ˆä¾‹å¦‚ï¼Œ[OpenAI](/docs/zh/openai.md)æˆ–[Azure OpenAI](/docs/zh/azure-openai.md)ï¼‰ã€‚
    

ä¸‹å›¾æ˜¾ç¤ºäº†é€šè¿‡ Milvus é…ç½®æ–‡ä»¶ (`milvus.yaml`) é…ç½®å‡­æ®ï¼Œç„¶ååœ¨ Milvus å†…è°ƒç”¨å‡½æ•°çš„è¿‡ç¨‹ã€‚

 ![Credential Config Overflow](/docs/v2.6.x/assets/credential-config-overflow.png)å‡­è¯é…ç½®æº¢å‡º

### æ­¥éª¤ 1ï¼šåœ¨ Milvus é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å‡­æ®

åœ¨`milvus.yaml` æ–‡ä»¶ä¸­ï¼Œç¼–è¾‘`credential` å—ï¼Œä¸ºéœ€è¦è®¿é—®çš„æ¯ä¸ªæä¾›å•†æ·»åŠ æ¡ç›®ï¼š

```yaml
# milvus.yaml credential store section
# This section defines all your authentication credentials for external embedding providers
# Each credential gets a unique name (e.g., aksk1, apikey1) that you'll reference elsewhere
credential:
  # For AWS Bedrock or services using access/secret key pairs
  # 'aksk1' is just an example name - you can choose any meaningful identifier
  aksk1:                       
    access_key_id: <YOUR_AK>      
    secret_access_key: <YOUR_SK>  
  
  # For OpenAI, Voyage AI, or other API key-based services
  # 'apikey1' is a custom name you choose to identify this credential  
  apikey1:                     
    apikey: <YOUR_API_KEY>        
  
  # For Google Vertex AI using service account credentials
  # 'gcp1' is an example name for your Google Cloud credentials
  gcp1:                        
    credential_json: <BASE64_OF_JSON>

  
    
  
```

### ç¬¬ 2 æ­¥ï¼šé…ç½®æä¾›å•†è®¾ç½®

åœ¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ (`milvus.yaml`) ä¸­ï¼Œç¼–è¾‘`function` å—ï¼Œå‘Šè¯‰ Milvus ä½¿ç”¨å“ªä¸ªå¯†é’¥åµŒå…¥æœåŠ¡è°ƒç”¨ï¼š

```yaml
function:
  textEmbedding:
    providers:
      openai:                         # calls OpenAI
        credential: apikey1           # Reference to the credential label
        # url:                        # (optional) custom url

      bedrock:                        # calls AWS Bedrock
        credential: aksk1             # Reference to the credential label
        region: us-east-2

      vertexai:                       # calls Google Vertex AI
        credential: gcp1              # Reference to the credential label
        # url:                        # (optional) custom url

      tei:                            # Built-in Tiny Embedding model
        enable: true                  # Whether to enable TEI model service

  
    
  
```

æœ‰å…³å¦‚ä½•åº”ç”¨ Milvus é…ç½®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ã€Š[åŠ¨æ€é…ç½® Milvus](/docs/zh/dynamic_config.md)ã€‹ã€‚

## ä½¿ç”¨ Embeddings åŠŸèƒ½

åœ¨ Milvus é…ç½®æ–‡ä»¶ä¸­é…ç½®å‡­è¯åï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®šä¹‰å’Œä½¿ç”¨åµŒå…¥å‡½æ•°ã€‚

### æ­¥éª¤ 1ï¼šå®šä¹‰ Schema å­—æ®µ

è¦ä½¿ç”¨åµŒå…¥åŠŸèƒ½ï¼Œè¯·åˆ›å»ºä¸€ä¸ªå…·æœ‰ç‰¹å®š Schema çš„ Collectionsã€‚è¯¥ Schema å¿…é¡»è‡³å°‘åŒ…å«ä¸‰ä¸ªå¿…è¦å­—æ®µï¼š

-   **ä¸»å­—æ®µ**ï¼Œç”¨äºå”¯ä¸€æ ‡è¯† Collections ä¸­çš„æ¯ä¸ªå®ä½“ã€‚
    
-   **æ ‡é‡å­—æ®µ**ï¼Œç”¨äºå­˜å‚¨è¦åµŒå…¥çš„åŸå§‹æ•°æ®ã€‚
    
-   ä¸€ä¸ª**å‘é‡**å­—æ®µï¼Œç”¨äºå­˜å‚¨å‡½æ•°å°†ä¸ºæ ‡é‡å­—æ®µç”Ÿæˆçš„å‘é‡åµŒå…¥ã€‚
    

ä¸‹é¢çš„ç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ª Schema æ¨¡å¼ï¼Œå…¶ä¸­ä¸€ä¸ªæ ‡é‡å­—æ®µ`"document"` ç”¨äºå­˜å‚¨æ–‡æœ¬æ•°æ®ï¼Œä¸€ä¸ªå‘é‡å­—æ®µ`"dense"` ç”¨äºå­˜å‚¨å°†ç”±å‡½æ•°æ¨¡å—ç”Ÿæˆçš„åµŒå…¥ã€‚åˆ‡è®°è®¾ç½®å‘é‡ç»´æ•° (`dim`) ä»¥åŒ¹é…æ‚¨æ‰€é€‰åµŒå…¥æ¨¡å‹çš„è¾“å‡ºã€‚

[Python](#python) [Java](#java) [NodeJS](#javascript) [Go](#go) [cURL](#bash)

```python
from pymilvus import MilvusClient, DataType, Function, FunctionType

# Initialize Milvus client
client = MilvusClient(
    uri="http://localhost:19530",
)

# Create a new schema for the collection
schema = client.create_schema()

# Add primary field "id"
schema.add_field("id", DataType.INT64, is_primary=True, auto_id=False)

# Add scalar field "document" for storing textual data
schema.add_field("document", DataType.VARCHAR, max_length=9000)

# Add vector field "dense" for storing embeddings.
# IMPORTANT: Set dim to match the exact output dimension of the embedding model.
# For instance, OpenAI's text-embedding-3-small model outputs 1536-dimensional vectors.
# For dense vector, data type can be FLOAT_VECTOR or INT8_VECTOR
schema.add_field("dense", DataType.FLOAT_VECTOR, dim=1536)

  
    
  
```

```java
// java

  
    
  
```

```javascript
// nodejs

  
    
  
```

```go
// go

  
    
  
```

```bash
# restful

  
    
  
```

### ç¬¬ 2 æ­¥ï¼šå‘ Schema æ·»åŠ åµŒå…¥å‡½æ•°

Milvus ä¸­çš„ Function æ¨¡å—ä¼šè‡ªåŠ¨å°†å­˜å‚¨åœ¨æ ‡é‡å­—æ®µä¸­çš„åŸå§‹æ•°æ®è½¬æ¢ä¸ºåµŒå…¥æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ°æ˜ç¡®å®šä¹‰çš„å‘é‡å­—æ®µä¸­ã€‚

ä¸‹é¢çš„ç¤ºä¾‹æ·»åŠ äº†ä¸€ä¸ª Function æ¨¡å— (`openai_embedding`) ï¼Œè¯¥æ¨¡å—å¯å°†æ ‡é‡å­—æ®µ`"document"` è½¬æ¢ä¸ºåµŒå…¥ï¼Œå°†ç”Ÿæˆçš„å‘é‡å­˜å‚¨åˆ°ä¹‹å‰å®šä¹‰çš„`"dense"` å‘é‡å­—æ®µä¸­ã€‚

[Python](#python) [Java](#java) [NodeJS](#javascript) [Go](#go) [cURL](#bash)

```python
# Define embedding function (example: OpenAI provider)
text_embedding_function = Function(
    name="openai_embedding",                  # Unique identifier for this embedding function
    function_type=FunctionType.TEXTEMBEDDING, # Type of embedding function
    input_field_names=["document"],           # Scalar field to embed
    output_field_names=["dense"],             # Vector field to store embeddings
    params={                                  # Provider-specific configuration (highest priority)
        "provider": "openai",                 # Embedding model provider
        "model_name": "text-embedding-3-small",     # Embedding model
        # "credential": "apikey1",            # Optional: Credential label
        # Optional parameters:
        # "dim": "1536",       # Optionally shorten the vector dimension
        # "user": "user123"    # Optional: identifier for API tracking
    }
)

# Add the embedding function to your schema
schema.add_function(text_embedding_function)

  
    
  
```

```java
// java

  
    
  
```

```javascript
// nodejs

  
    
  
```

```go
// go

  
    
  
```

```bash
# restful

  
    
  
```

å‚æ•°

è¯´æ˜

ç¤ºä¾‹å€¼

`name`

åµŒå…¥å‡½æ•°åœ¨ Milvus ä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

`"openai_embedding"`

`function_type`

ä½¿ç”¨çš„å‡½æ•°ç±»å‹ã€‚å¯¹äºæ–‡æœ¬åµŒå…¥ï¼Œå°†å€¼è®¾ä¸º`FunctionType.TEXTEMBEDDING` ã€‚

**æ³¨**ï¼šMilvus æ¥å—`FunctionType.BM25` ï¼ˆç”¨äºç¨€ç–åµŒå…¥è½¬æ¢ï¼‰å’Œ`FunctionType.RERANK` ï¼ˆç”¨äº Rerankerï¼‰ä½œä¸ºè¯¥å‚æ•°ã€‚è¯¦æƒ…è¯·å‚é˜…[å…¨æ–‡æœç´¢](/docs/zh/full-text-search.md)å’Œ[è¡°å‡æ’åå™¨æ¦‚è¿°](/docs/zh/decay-ranker-overview.md)ã€‚

`FunctionType.TEXTEMBEDDING`

`input_field_names`

åŒ…å«è¦åµŒå…¥çš„åŸå§‹æ•°æ®çš„æ ‡é‡å­—æ®µã€‚ç›®å‰ï¼Œè¯¥å‚æ•°åªæ¥å—ä¸€ä¸ªå­—æ®µåç§°ã€‚

`["document"]`

`output_field_names`

å‘é‡å­—æ®µï¼Œç”¨äºå­˜å‚¨ç”Ÿæˆçš„ Embeddingsã€‚ç›®å‰ï¼Œè¯¥å‚æ•°åªæ¥å—ä¸€ä¸ªå­—æ®µåç§°ã€‚

`["dense"]`

`params`

åŒ…å«åµŒå…¥é…ç½®çš„å­—å…¸ã€‚æ³¨ï¼š`params` ä¸­çš„å‚æ•°å› åµŒå…¥æ¨¡å‹æä¾›è€…è€Œå¼‚ã€‚

`{...}`

`provider`

åµŒå…¥æ¨¡å‹æä¾›è€…ã€‚

`"openai"`

`model_name`

æŒ‡å®šè¦ä½¿ç”¨çš„åµŒå…¥æ¨¡å‹ã€‚

`"text-embedding-3-small"`

`credential`

`milvus.yaml` é¡¶å±‚`credential:` éƒ¨åˆ†å®šä¹‰çš„å‡­è¯æ ‡ç­¾ã€‚

-   æä¾›æ—¶ï¼ŒMilvus ä¼šæ£€ç´¢åŒ¹é…çš„å¯†é’¥å¯¹æˆ– API ä»¤ç‰Œï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯ç­¾ç½²è¯·æ±‚ã€‚
    
-   çœç•¥æ—¶ï¼ˆ`None` ï¼‰ï¼ŒMilvus ä¼šé€€å›åˆ°`milvus.yaml` ä¸­ä¸ºç›®æ ‡æ¨¡å‹æä¾›è€…æ˜ç¡®é…ç½®çš„å‡­æ®ã€‚
    
-   å¦‚æœæ ‡ç­¾æœªçŸ¥æˆ–å¼•ç”¨çš„å¯†é’¥ä¸¢å¤±ï¼Œåˆ™è°ƒç”¨å¤±è´¥ã€‚
    

`"apikey1"`

`dim`

è¾“å‡ºåµŒå…¥çš„ç»´æ•°ã€‚å¯¹äº OpenAI çš„ç¬¬ä¸‰ä»£æ¨¡å‹ï¼Œæ‚¨å¯ä»¥ç¼©çŸ­å…¨å‘é‡ä»¥é™ä½æˆæœ¬å’Œå»¶è¿Ÿï¼ŒåŒæ—¶ä¸ä¼šæŸå¤±å¤§é‡è¯­ä¹‰ä¿¡æ¯ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[OpenAI å…¬å‘Šåšæ–‡](https://openai.com/blog/new-embedding-models-and-api-updates)ã€‚

**æ³¨æ„ï¼š**å¦‚æœæ‚¨ç¼©çŸ­äº†å‘é‡ç»´åº¦ï¼Œè¯·ç¡®ä¿ Schema çš„`add_field` æ–¹æ³•ä¸­ä¸ºå‘é‡å­—æ®µæŒ‡å®šçš„`dim` å€¼ä¸æ‚¨çš„åµŒå…¥å‡½æ•°çš„æœ€ç»ˆè¾“å‡ºç»´åº¦ç›¸åŒ¹é…ã€‚

`"1536"`

`user`

ç”¨äºè·Ÿè¸ª API ä½¿ç”¨æƒ…å†µçš„ç”¨æˆ·çº§æ ‡è¯†ç¬¦ã€‚

`"user123"`

å¯¹äºå…·æœ‰å¤šä¸ªéœ€è¦è¿›è¡Œæ–‡æœ¬åˆ°å‘é‡è½¬æ¢çš„æ ‡é‡å­—æ®µçš„ Collectionsï¼Œè¯·åœ¨ Collections Schema ä¸­æ·»åŠ å•ç‹¬çš„å‡½æ•°ï¼Œç¡®ä¿æ¯ä¸ªå‡½æ•°éƒ½æœ‰å”¯ä¸€çš„åç§°å’Œ`output_field_names` å€¼ã€‚

### ç¬¬ 3 æ­¥ï¼šé…ç½®ç´¢å¼•

åœ¨å®šä¹‰äº†åŒ…å«å¿…è¦å­—æ®µå’Œå†…ç½®å‡½æ•°çš„ Schema åï¼Œè¯·ä¸ºæ‚¨çš„ Collection è®¾ç½®ç´¢å¼•ã€‚ä¸ºç®€åŒ–è¿™ä¸€è¿‡ç¨‹ï¼Œè¯·ä½¿ç”¨`AUTOINDEX` ä½œä¸º`index_type` ï¼Œè¯¥é€‰é¡¹å…è®¸ Milvus æ ¹æ®æ•°æ®ç»“æ„é€‰æ‹©å’Œé…ç½®æœ€åˆé€‚çš„ç´¢å¼•ç±»å‹ã€‚

[Python](#python) [Java](#java) [NodeJS](#javascript) [Go](#go) [cURL](#bash)

```python
# Prepare index parameters
index_params = client.prepare_index_params()

# Add AUTOINDEX to automatically select optimal indexing method
index_params.add_index(
    field_name="dense",
    index_type="AUTOINDEX",
    metric_type="COSINE" 
)

  
    
  
```

```java
// java

  
    
  
```

```javascript
// nodejs

  
    
  
```

```go
// go

  
    
  
```

```bash
# restful

  
    
  
```

### ç¬¬ 4 æ­¥ï¼šåˆ›å»º Collections

ç°åœ¨ä½¿ç”¨å®šä¹‰çš„ Schema å’Œç´¢å¼•å‚æ•°åˆ›å»º Collectionsã€‚

[Python](#python) [Java](#java) [NodeJS](#javascript) [Go](#go) [cURL](#bash)

```python
# Create collection named "demo"
client.create_collection(
    collection_name='demo', 
    schema=schema, 
    index_params=index_params
)

  
    
  
```

```java
// java

  
    
  
```

```javascript
// nodejs

  
    
  
```

```go
// go

  
    
  
```

```bash
# restful

  
    
  
```

### ç¬¬ 5 æ­¥ï¼šæ’å…¥æ•°æ®

è®¾ç½®å¥½é›†åˆå’Œç´¢å¼•åï¼Œå°±å¯ä»¥æ’å…¥åŸå§‹æ•°æ®äº†ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæ‚¨åªéœ€æä¾›åŸå§‹æ–‡æœ¬ã€‚æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„ Function æ¨¡å—ä¼šä¸ºæ¯ä¸ªæ–‡æœ¬æ¡ç›®è‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„ç¨€ç–å‘é‡ã€‚

[Python](#python) [Java](#java) [NodeJS](#javascript) [Go](#go) [cURL](#bash)

```python
# Insert sample documents
client.insert('demo', [
    {'id': 1, 'document': 'Milvus simplifies semantic search through embeddings.'},
    {'id': 2, 'document': 'Vector embeddings convert text into searchable numeric data.'},
    {'id': 3, 'document': 'Semantic search helps users find relevant information quickly.'},
])

  
    
  
```

```java
// java

  
    
  
```

```javascript
// nodejs

  
    
  
```

```go
// go

  
    
  
```

```bash
# restful

  
    
  
```

### æ­¥éª¤ 6ï¼šæ‰§è¡Œå‘é‡æœç´¢

æ’å…¥æ•°æ®åï¼Œä½¿ç”¨åŸå§‹æŸ¥è¯¢æ–‡æœ¬æ‰§è¡Œè¯­ä¹‰æœç´¢ã€‚Milvus ä¼šè‡ªåŠ¨å°†æŸ¥è¯¢è½¬æ¢ä¸ºåµŒå…¥å‘é‡ï¼Œæ ¹æ®ç›¸ä¼¼åº¦æ£€ç´¢ç›¸å…³æ–‡æ¡£ï¼Œå¹¶è¿”å›åŒ¹é…åº¦æœ€é«˜çš„ç»“æœã€‚

[Python](#python) [Java](#java) [NodeJS](#javascript) [Go](#go) [cURL](#bash)

```python
# Perform semantic search
results = client.search(
    collection_name='demo', 
    data=['How does Milvus handle semantic search?'], # Use text query rather than query vector
    anns_field='dense',   # Use the vector field that stores embeddings
    limit=1,
    output_fields=['document'],
)

print(results)

# Example output:
# data: ["[{'id': 1, 'distance': 0.8821347951889038, 'entity': {'document': 'Milvus simplifies semantic search through embeddings.'}}]"]

  
    
  
```

```java
// java

  
    
  
```

```javascript
// nodejs

  
    
  
```

```go
// go

  
    
  
```

```bash
# restful

  
    
  
```

æœ‰å…³æœç´¢å’ŒæŸ¥è¯¢æ“ä½œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[åŸºæœ¬å‘é‡æœç´¢](/docs/zh/single-vector-search.md)å’Œ[æŸ¥è¯¢](/docs/zh/get-and-scalar-query.md)ã€‚

## å¸¸è§é—®é¢˜

### åœ¨ milvus.yaml ä¸ç¯å¢ƒå˜é‡ä¸­é…ç½®è¯ä¹¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†å»ºè®®ä½¿ç”¨`milvus.yaml` ï¼Œå› ä¸ºå®ƒæä¾›äº†é›†ä¸­çš„å‡­æ®ç®¡ç†å’Œè·¨æ‰€æœ‰æä¾›å•†çš„ä¸€è‡´å‡­æ®å‘½åã€‚ä½¿ç”¨ç¯å¢ƒå˜é‡æ—¶ï¼Œå˜é‡åç§°å› åµŒå…¥æœåŠ¡æä¾›å•†è€Œå¼‚ï¼Œå› æ­¤è¯·å‚é˜…æ¯ä¸ªæä¾›å•†çš„ä¸“ç”¨é¡µé¢ï¼Œäº†è§£æ‰€éœ€çš„ç‰¹å®šç¯å¢ƒå˜é‡åç§°ï¼ˆä¾‹å¦‚ï¼Œ[OpenAI](/docs/zh/openai.md)æˆ–[Azure OpenAI](/docs/zh/azure-openai.md)ï¼‰ã€‚

### å¦‚æœæˆ‘æ²¡æœ‰åœ¨å‡½æ•°å®šä¹‰ä¸­æŒ‡å®šå‡­æ®å‚æ•°ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ

Milvus éµå¾ªè¿™ç§å‡­æ®è§£æé¡ºåºï¼š

1.  é¦–å…ˆï¼Œå®ƒä¼šåœ¨`milvus.yaml` æ–‡ä»¶ä¸­æŸ¥æ‰¾ä¸ºè¯¥æä¾›å•†é…ç½®çš„é»˜è®¤å‡­æ®
2.  å¦‚æœ Milvus.yaml ä¸­ä¸å­˜åœ¨é»˜è®¤å‡­æ®ï¼Œå®ƒå°±ä¼šè¿”å›åˆ°ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœå·²é…ç½®ï¼‰ã€‚
3.  å¦‚æœ`milvus.yaml` å‡­æ®å’Œç¯å¢ƒå˜é‡éƒ½æ²¡æœ‰é…ç½®ï¼ŒMilvus ä¼šå‡ºé”™

### å¦‚ä½•éªŒè¯ Embeddings ç”Ÿæˆæ˜¯å¦æ­£ç¡®ï¼Ÿ

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œæ£€æŸ¥

1.  æ’å…¥åæŸ¥è¯¢ Collectionsï¼ŒæŸ¥çœ‹å‘é‡å­—æ®µæ˜¯å¦åŒ…å«æ•°æ®
2.  æ£€æŸ¥å‘é‡å­—æ®µçš„é•¿åº¦æ˜¯å¦ç¬¦åˆä½ çš„é¢„æœŸå°ºå¯¸
3.  æ‰§è¡Œç®€å•çš„ç›¸ä¼¼æ€§æœç´¢ï¼ŒéªŒè¯åµŒå…¥æ˜¯å¦äº§ç”Ÿäº†æœ‰æ„ä¹‰çš„ç»“æœ

### æ‰§è¡Œç›¸ä¼¼æ€§æœç´¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢å‘é‡è€Œä¸æ˜¯åŸå§‹æ–‡æœ¬å—ï¼Ÿ

å¯ä»¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨é¢„è®¡ç®—çš„æŸ¥è¯¢å‘é‡ä»£æ›¿åŸå§‹æ–‡æœ¬è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ã€‚è™½ç„¶ Function æ¨¡å—ä¼šè‡ªåŠ¨å°†åŸå§‹æ–‡æœ¬æŸ¥è¯¢è½¬æ¢ä¸ºåµŒå…¥ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥åœ¨æœç´¢æ“ä½œä¸­ç›´æ¥å‘`data` å‚æ•°æä¾›å‘é‡æ•°æ®ã€‚**æ³¨æ„**ï¼šæ‚¨æä¾›çš„æŸ¥è¯¢å‘é‡çš„ç»´åº¦å¤§å°å¿…é¡»ä¸æ‚¨çš„ Function æ¨¡å—ç”Ÿæˆçš„å‘é‡åµŒå…¥çš„ç»´åº¦å¤§å°ä¸€è‡´ã€‚

**ç¤ºä¾‹**

[Python](#python) [Java](#java) [NodeJS](#javascript) [Go](#go) [cURL](#bash)

```python
# Using raw text (Function module converts automatically)
results = client.search(
    collection_name='demo', 
    data=['How does Milvus handle semantic search?'],
    anns_field='dense',
    limit=1
)

# Using pre-computed query vector (must match stored vector dimensions)
query_vector = [0.1, 0.2, 0.3, ...]  # Must be same dimension as stored embeddings
results = client.search(
    collection_name='demo', 
    data=[query_vector],
    anns_field='dense',
    limit=1
)

  
    
  
```

```java
// java

  
    
  
```

```javascript
// nodejs

  
    
  
```

```go
// go

  
    
  
```

```bash
# restful

  
    
  
```

ç¿»è¯‘è‡ª![DeepL](/_next/static/media/deepl.d32c6a10.png)

##### ç›®å½•

-   [åµŒå…¥å‡½æ•°æ¦‚è¿°Compatible with Milvus 2.6.x](#Embedding-Function-Overview)
-   [é™åˆ¶](#Limits)
-   [æ”¯æŒçš„åµŒå…¥æœåŠ¡æä¾›å•†](#Supported-embedding-service-providers)
-   [å·¥ä½œåŸç†](#How-it-works)
-   [é…ç½®å‡­è¯](#Configure-credentials)
-   [æ­¥éª¤ 1ï¼šåœ¨ Milvus é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å‡­æ®](#Step-1-Add-credentials-to-Milvus-configuration-file)
-   [ç¬¬ 2 æ­¥ï¼šé…ç½®æä¾›å•†è®¾ç½®](#Step-2-Configure-provider-settings)
-   [ä½¿ç”¨ Embeddings åŠŸèƒ½](#Use-embedding-function)
-   [æ­¥éª¤ 1ï¼šå®šä¹‰ Schema å­—æ®µ](#Step-1-Define-schema-fields)
-   [ç¬¬ 2 æ­¥ï¼šå‘ Schema æ·»åŠ åµŒå…¥å‡½æ•°](#Step-2-Add-embedding-function-to-schema)
-   [ç¬¬ 3 æ­¥ï¼šé…ç½®ç´¢å¼•](#Step-3-Configure-index)
-   [ç¬¬ 4 æ­¥ï¼šåˆ›å»º Collections](#Step-4-Create-collection)
-   [ç¬¬ 5 æ­¥ï¼šæ’å…¥æ•°æ®](#Step-5-Insert-data)
-   [æ­¥éª¤ 6ï¼šæ‰§è¡Œå‘é‡æœç´¢](#Step-6-Perform-vector-search)
-   [å¸¸è§é—®é¢˜](#FAQ)
-   [åœ¨ milvus.yaml ä¸ç¯å¢ƒå˜é‡ä¸­é…ç½®è¯ä¹¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ](#Whats-the-difference-between-configuring-credentials-in-milvusyaml-vs-environment-variables)
-   [å¦‚æœæˆ‘æ²¡æœ‰åœ¨å‡½æ•°å®šä¹‰ä¸­æŒ‡å®šå‡­æ®å‚æ•°ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ](#What-happens-if-I-dont-specify-a-credential-parameter-in-the-function-definition)
-   [å¦‚ä½•éªŒè¯ Embeddings ç”Ÿæˆæ˜¯å¦æ­£ç¡®ï¼Ÿ](#How-can-I-verify-that-embeddings-are-being-generated-correctly)
-   [æ‰§è¡Œç›¸ä¼¼æ€§æœç´¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢å‘é‡è€Œä¸æ˜¯åŸå§‹æ–‡æœ¬å—ï¼Ÿ](#When-I-perform-a-similarity-search-can-I-use-a-query-vector-rather-than-raw-text)

## æƒ³è¦æ›´å¿«ã€æ›´ç®€å•ã€æ›´å¥½ç”¨çš„ Milvus SaaSæœåŠ¡ ï¼Ÿ

Zilliz Cloudæ˜¯åŸºäºMilvusçš„å…¨æ‰˜ç®¡å‘é‡æ•°æ®åº“ï¼Œæ‹¥æœ‰æ›´é«˜æ€§èƒ½ï¼Œæ›´æ˜“æ‰©å±•ï¼Œä»¥åŠå“è¶Šæ€§ä»·æ¯”

[å…è´¹è¯•ç”¨ Zilliz Cloud](https://cloud.zilliz.com.cn/signup?utm_source=milvusio&utm_medium=referral&utm_campaign=milvus_right_card&utm_content=docs/zh/embedding-function-overview.md)

##### åé¦ˆ

æ­¤é¡µå¯¹æ‚¨æ˜¯å¦æœ‰å¸®åŠ©?

Ask AI![](/inkeep/milvus-icon-white.png)
---
# åŠ æƒæ’åå™¨ | Milvus æ–‡æ¡£

[ğŸš€ Zilliz äº‘ï¼šå…¨é¢ç®¡ç† Milvus - é€Ÿåº¦å¿« 10 å€ã€‚é›¶çƒ¦æ¼ã€‚ä¸“ä¸ºäººå·¥æ™ºèƒ½æ‰“é€ ã€‚ç«‹å³å…è´¹è¯•ç”¨ â†’](https://cloud.zilliz.com/signup?utm_source=milvusio&utm_medium=referral&utm_campaign=milvus_top_banner&utm_content=docs/zh/weighted-ranker.md)

[![Milvus](/images/layout/milvus-logo.svg)](/zh)

[![Zilliz](/images/layout/zilliz-logo.svg)](https://zilliz.com/)

-   ä¸ºä»€ä¹ˆé€‰æ‹© Milvus
    
    -   [ä»€ä¹ˆæ˜¯ Milvus](/zh/intro)
    -   [ä½¿ç”¨æ¡ˆä¾‹](/zh/use-cases)
    
-   [æ–‡æ¡£](/docs/zh)
-   æ•™ç¨‹
    
    -   [è®­ç»ƒè¥](/zh/bootcamp)
    -   [æ¼”ç¤º](/zh/milvus-demos)
    -   [è§†é¢‘](https://www.youtube.com/c/MilvusVectorDatabase)
    
-   å·¥å…·
    
    -   [Attu](https://github.com/zilliztech/attu)
    -   [Milvus CLI](https://github.com/zilliztech/milvus_cli)
    -   [é…ç½®å·¥å…·](/zh/tools/sizing)
    -   [Milvus å¤‡ä»½](https://github.com/zilliztech/milvus-backup)
    -   [VTS](https://github.com/zilliztech/vts)
    -   [æ·±åº¦æœç´¢å™¨](https://github.com/zilliztech/deep-searcher)
    -   [Claude Context](https://github.com/zilliztech/claude-context)
    
-   [åšå®¢](/zh/blog)
-   ç¤¾åŒº
    
    -   [ç±³å°”æ²ƒæ–¯åŠå…¬æ—¶é—´](https://meetings.hubspot.com/chloe-williams1/milvus-office-hour?uuid=4cb203e5-482a-47e0-90a6-7acc511d61f4)
    -   [æ¾å¼›](https://milvus.io/slack )
    -   [Discord](https://milvus.io/discord)
    -   [GitHub](https://github.com/milvus-io/milvus/discussions)
    -   [æ›´å¤šç¤¾åŒº](/zh/community)
    

ç®€ä½“ä¸­æ–‡

[Star42.6K](https://github.com/milvus-io/milvus)[é¢„çº¦æ¼”ç¤º](/zh/contact)[

å¼€å§‹ä½¿ç”¨

](https://cloud.zilliz.com/signup?utm_source=milvusio&utm_medium=referral&utm_campaign=milvus_nav_right&utm_content=docs/zh/weighted-ranker.md)

[![Milvus](/images/layout/milvus-logo.svg)](/zh)

[![Zilliz](/images/layout/zilliz-logo.svg)](https://zilliz.com/)

ç®€ä½“ä¸­æ–‡

æœç´¢K

[é¦–é¡µ](/docs/zh)

[v2.6.x](/docs/weighted-ranker.md)

â€‹

-   å…³äº Milvus
    
-   å¼€å§‹
    
-   æ¦‚å¿µ
    
-   ç”¨æˆ·æŒ‡å—
    
    -   [æ•°æ®åº“](/docs/zh/manage_databases.md)
        
    -   Collections
        
    -   Schema å’Œæ•°æ®å­—æ®µ
        
    -   æ’å…¥å’Œåˆ é™¤
        
    -   ç´¢å¼•
        
    -   æœç´¢
        
    -   Embeddings &amp; Rerankers
        
        -   åµŒå…¥åŠŸèƒ½
            
        -   Rerankers åŠŸèƒ½
            
            -   [åŠ æƒæ’å](/docs/zh/weighted-ranker.md)
                
            -   [RRF æ’è¡Œæ¦œ](/docs/zh/rrf-ranker.md)
                
            -   [æå‡æ’åå™¨](/docs/zh/boost-ranker.md)
                
            -   è¡°å˜æ’åå™¨
                
            -   æ¨¡å‹æ’åå™¨
                
            
        
    -   å­˜å‚¨ä¼˜åŒ–
        
    
-   æ•°æ®å¯¼å…¥
    
-   ç®¡ç†æŒ‡å—
    
-   å·¥å…·
    
-   é›†æˆ
    
-   æ•™ç¨‹
    
-   å¸¸è§é—®é¢˜
    
-   API Reference
    

-   [é¦–é¡µ](/zh)
-   [æ–‡æ¡£](/docs/zh)
-   ç”¨æˆ·æŒ‡å—
    
-   Embeddings &amp; Rerankers
    
-   Rerankers åŠŸèƒ½
    
-   åŠ æƒæ’å
    

# åŠ æƒæ’åå™¨

åŠ æƒæ’åå™¨é€šè¿‡ä¸ºæ¯ä¸ªæœç´¢è·¯å¾„åˆ†é…ä¸åŒçš„é‡è¦æ€§æƒé‡ï¼Œæ™ºèƒ½åœ°ç»„åˆæ¥è‡ªå¤šä¸ªæœç´¢è·¯å¾„çš„ç»“æœå¹¶ç¡®å®šå…¶ä¼˜å…ˆçº§ã€‚ä¸æŠ€è‰ºé«˜è¶…çš„å¨å¸ˆå¹³è¡¡å¤šç§é…æ–™ä»¥åˆ¶ä½œå®Œç¾èœè‚´çš„æ–¹å¼ç±»ä¼¼ï¼ŒåŠ æƒæ’åå™¨ä¹Ÿä¼šå¹³è¡¡ä¸åŒçš„æœç´¢ç»“æœï¼Œä»¥æä¾›æœ€ç›¸å…³çš„ç»¼åˆç»“æœã€‚è¿™ç§æ–¹æ³•éå¸¸é€‚åˆåœ¨å¤šä¸ªå‘é‡åœºæˆ–æ¨¡å¼ä¸­è¿›è¡Œæœç´¢ï¼Œå…¶ä¸­æŸäº›åœºå¯¹æœ€ç»ˆæ’åçš„è´¡çŒ®åº”æ¯”å…¶ä»–åœºæ›´å¤§ã€‚

## ä½•æ—¶ä½¿ç”¨åŠ æƒæ’åå™¨

åŠ æƒæ’åå™¨æ˜¯ä¸“é—¨ä¸ºæ··åˆæœç´¢æ–¹æ¡ˆè®¾è®¡çš„ï¼Œåœ¨è¿™ç§æ–¹æ¡ˆä¸­ï¼Œæ‚¨éœ€è¦å°†æ¥è‡ªå¤šä¸ª çŸ¢é‡æœç´¢è·¯å¾„çš„ç»“æœè¿›è¡Œç»„åˆã€‚å®ƒå¯¹ä»¥ä¸‹æƒ…å†µç‰¹åˆ«æœ‰æ•ˆ

ä½¿ç”¨æ¡ˆä¾‹

å®ä¾‹

ä¸ºä»€ä¹ˆåŠ æƒæ’åå™¨æ•ˆæœå¥½

ç”µå­å•†åŠ¡æœç´¢

ç»“åˆå›¾ç‰‡ç›¸ä¼¼åº¦å’Œæ–‡å­—æè¿°çš„äº§å“æœç´¢

å…è®¸é›¶å”®å•†ä¼˜å…ˆè€ƒè™‘æ—¶å°šäº§å“çš„è§†è§‰ç›¸ä¼¼æ€§ï¼ŒåŒæ—¶å¼ºè°ƒæŠ€æœ¯äº§å“çš„æ–‡å­—æè¿°

åª’ä½“å†…å®¹æœç´¢

ä½¿ç”¨è§†è§‰ç‰¹å¾å’ŒéŸ³é¢‘è½¬å½•è¿›è¡Œè§†é¢‘æ£€ç´¢

æ ¹æ®æŸ¥è¯¢æ„å›¾å¹³è¡¡è§†è§‰å†…å®¹å’Œè¯­éŸ³å¯¹è¯çš„é‡è¦æ€§

æ–‡æ¡£æ£€ç´¢

é’ˆå¯¹ä¸åŒéƒ¨åˆ†ä½¿ç”¨å¤šç§ Embeddings çš„ä¼ä¸šæ–‡æ¡£æœç´¢

åœ¨è€ƒè™‘å…¨æ–‡åµŒå…¥çš„åŒæ—¶ï¼Œèµ‹äºˆæ ‡é¢˜å’Œæ‘˜è¦åµŒå…¥æ›´é«˜çš„æƒé‡

å¦‚æœæ‚¨çš„æ··åˆæœç´¢åº”ç”¨éœ€è¦ç»“åˆå¤šç§æœç´¢è·¯å¾„ï¼ŒåŒæ—¶æ§åˆ¶å…¶ç›¸å¯¹é‡è¦æ€§ï¼Œé‚£ä¹ˆåŠ æƒæ’åå™¨å°±æ˜¯æ‚¨çš„ç†æƒ³é€‰æ‹©ã€‚

## åŠ æƒæ’åºå™¨çš„æœºåˆ¶

åŠ æƒæ’åç­–ç•¥çš„ä¸»è¦å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

1.  **Collections æœç´¢å¾—åˆ†**ï¼šæ”¶é›†å‘é‡æœç´¢å„è·¯å¾„çš„ç»“æœå’Œåˆ†æ•°ï¼ˆscore\_1ã€score\_2ï¼‰ã€‚
    
2.  **åˆ†æ•°å½’ä¸€åŒ–**ï¼šæ¯æ¬¡æœç´¢å¯èƒ½ä¼šä½¿ç”¨ä¸åŒçš„ç›¸ä¼¼åº¦æŒ‡æ ‡ï¼Œä»è€Œå¯¼è‡´ä¸åŒçš„åˆ†æ•°åˆ†å¸ƒã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ "å†…ç§¯"ï¼ˆIPï¼‰ä½œä¸ºç›¸ä¼¼åº¦ç±»å‹å¯èƒ½ä¼šäº§ç”Ÿ\[-âˆ,+âˆ\]çš„åˆ†æ•°ï¼Œè€Œä½¿ç”¨ "æ¬§æ°è·ç¦»"ï¼ˆL2ï¼‰åˆ™ä¼šäº§ç”Ÿ\[0,+âˆ\]çš„åˆ†æ•°ã€‚ç”±äºä¸åŒæœç´¢çš„å¾—åˆ†èŒƒå›´å„ä¸ç›¸åŒï¼Œæ— æ³•ç›´æ¥æ¯”è¾ƒï¼Œå› æ­¤æœ‰å¿…è¦å¯¹æ¯æ¡æœç´¢è·¯å¾„çš„å¾—åˆ†è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ã€‚é€šå¸¸ï¼Œ`arctan` å‡½æ•°ç”¨äºå°†åˆ†æ•°è½¬æ¢ä¸º \[0, 1\] ä¹‹é—´çš„èŒƒå›´ï¼ˆscore\_1\_normalized, score\_2\_normalizedï¼‰ã€‚åˆ†æ•°è¶Šæ¥è¿‘ 1 è¡¨ç¤ºç›¸ä¼¼åº¦è¶Šé«˜ã€‚
    
3.  **åˆ†é…æƒé‡**ï¼šæ ¹æ®åˆ†é…ç»™ä¸åŒå‘é‡åœºçš„é‡è¦æ€§ï¼Œä¸ºå½’ä¸€åŒ–åˆ†æ•°ï¼ˆscore\_1\_normalizedï¼Œscore\_2\_normalizedï¼‰åˆ†é…æƒé‡ï¼ˆ**wi**ï¼‰ã€‚æ¯æ¡è·¯å¾„çš„æƒé‡èŒƒå›´åº”åœ¨ \[0,1\] ä¹‹é—´ã€‚ç”±æ­¤å¾—å‡ºçš„åŠ æƒåˆ†æ•°ä¸º score\_1\_weighted å’Œ score\_2\_weightedã€‚
    
4.  **åˆå¹¶åˆ†æ•°**ï¼šå°†åŠ æƒåˆ†æ•°ï¼ˆscore\_1\_weightedã€score\_2\_weightedï¼‰ä»é«˜åˆ°ä½æ’åºï¼Œå¾—å‡ºæœ€ç»ˆåˆ†æ•°é›†ï¼ˆscore\_finalï¼‰ã€‚
    

 ![Weighted Ranker](/docs/v2.6.x/assets/weighted-ranker.png)åŠ æƒæ’åå™¨

## åŠ æƒæ’åºå™¨ç¤ºä¾‹

æœ¬ä¾‹æ¼”ç¤ºäº†æ¶‰åŠå›¾åƒå’Œæ–‡æœ¬çš„å¤šæ¨¡æ€æ··åˆæœç´¢ï¼ˆtopK=5ï¼‰ï¼Œå¹¶è¯´æ˜äº†åŠ æƒ Ranker ç­–ç•¥å¦‚ä½•å¯¹ä¸¤æ¬¡ ANN æœç´¢çš„ç»“æœè¿›è¡Œé‡æ–°æ’åºã€‚

-   å›¾åƒçš„ ANN æœç´¢ç»“æœï¼ˆtopK=5ï¼‰ï¼š ID
    
    **ID**
    
    **å¾—åˆ†ï¼ˆå›¾åƒï¼‰**
    
    101
    
    0.92
    
    203
    
    0.88
    
    150
    
    0.85
    
    198
    
    0.83
    
    175
    
    0.8
    
-   æ–‡æœ¬çš„ ANN æœç´¢ç»“æœï¼ˆtopK=5ï¼‰ï¼š ID
    
    **ID**
    
    **å¾—åˆ†ï¼ˆæ–‡æœ¬ï¼‰**
    
    198
    
    0.91
    
    101
    
    0.87
    
    110
    
    0.85
    
    175
    
    0.82
    
    250
    
    0.78
    
-   ä½¿ç”¨ WeightedRanker ä¸ºå›¾åƒå’Œæ–‡æœ¬æœç´¢ç»“æœåˆ†é…æƒé‡ã€‚å‡è®¾å›¾åƒ ANN æœç´¢çš„æƒé‡ä¸º 0.6ï¼Œæ–‡æœ¬æœç´¢çš„æƒé‡ä¸º 0.4ã€‚
    
    **ID**
    
    **å¾—åˆ†ï¼ˆå›¾åƒï¼‰**
    
    **å¾—åˆ†ï¼ˆæ–‡æœ¬ï¼‰**
    
    **åŠ æƒå¾—åˆ†**
    
    101
    
    0.92
    
    0.87
    
    0.6Ã—0.92+0.4Ã—0.87=0.90
    
    203
    
    0.88
    
    ä¸é€‚ç”¨
    
    0.6Ã—0.88+0.4Ã—0=0.528
    
    150
    
    0.85
    
    ä¸é€‚ç”¨
    
    0.6Ã—0.85+0.4Ã—0=0.51
    
    198
    
    0.83
    
    0.91
    
    0.6Ã—0.83+0.4Ã—0.91=0.86
    
    175
    
    0.80
    
    0.82
    
    0.6Ã—0.80+0.4Ã—0.82=0.81
    
    110
    
    ä¸åœ¨å›¾åƒä¸­
    
    0.85
    
    0.6Ã—0+0.4Ã—0.85=0.34
    
    250
    
    ä¸åœ¨å›¾åƒä¸­
    
    0.78
    
    0.6Ã—0+0.4Ã—0.78=0.312
    
-   é‡æ–°æ’åºåçš„æœ€ç»ˆç»“æœï¼ˆtopK=5ï¼‰ï¼š 0.6Ã—0+0.4Ã—0.85=0.34
    
    **æ’å**
    
    **ID**
    
    **æœ€ç»ˆå¾—åˆ†**
    
    1
    
    101
    
    0.90
    
    2
    
    198
    
    0.86
    
    3
    
    175
    
    0.81
    
    4
    
    203
    
    0.528
    
    5
    
    150
    
    0.51
    

## åŠ æƒæ’åå™¨çš„ä½¿ç”¨

ä½¿ç”¨åŠ æƒæ’åç­–ç•¥æ—¶ï¼Œéœ€è¦è¾“å…¥æƒé‡å€¼ã€‚è¾“å…¥æƒé‡å€¼çš„æ•°é‡åº”ä¸æ··åˆæœç´¢ä¸­åŸºæœ¬ ANN æœç´¢è¯·æ±‚çš„æ•°é‡ä¸€è‡´ã€‚è¾“å…¥çš„æƒé‡å€¼èŒƒå›´åº”ä¸º \[0,1\]ï¼Œæ•°å€¼è¶Šæ¥è¿‘ 1 è¡¨ç¤ºé‡è¦æ€§è¶Šé«˜ã€‚

### åˆ›å»ºåŠ æƒæ’åºå™¨

ä¾‹å¦‚ï¼Œå‡è®¾æ··åˆæœç´¢ä¸­æœ‰ä¸¤ä¸ªåŸºæœ¬ ANN æœç´¢è¯·æ±‚ï¼šæ–‡æœ¬æœç´¢å’Œå›¾åƒæœç´¢ã€‚å¦‚æœè®¤ä¸ºæ–‡æœ¬æœç´¢æ›´é‡è¦ï¼Œå°±åº”è¯¥èµ‹äºˆå®ƒæ›´å¤§çš„æƒé‡ã€‚

Milvus 2.6.x åŠæ›´é«˜ç‰ˆæœ¬å¯è®©æ‚¨ç›´æ¥é€šè¿‡`Function` API é…ç½® Reranker ç­–ç•¥ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ—©æœŸç‰ˆæœ¬ï¼ˆv2.6.0 ä¹‹å‰ï¼‰ï¼Œè¯·å‚è€ƒ[Rerankers](https://milvus.io/docs/v2.5.x/reranking.md#Usage-of-WeightedRanker)æ–‡æ¡£ä¸­çš„è®¾ç½®è¯´æ˜ã€‚

[Python](#python) [Java](#java) [NodeJS](#javascript) [Go](#go) [cURL](#bash)

```python
from pymilvus import Function, FunctionType

rerank = Function(
    name="weight",
    input_field_names=[], # Must be an empty list
    function_type=FunctionType.RERANK,
    params={
        "reranker": "weighted", 
        "weights": [0.1, 0.9],
        "norm_score": True  # Optional
    }
)

  
    
  
```

```java
import io.milvus.common.clientenum.FunctionType;
import io.milvus.v2.service.collection.request.CreateCollectionReq;

CreateCollectionReq.Function rerank = CreateCollectionReq.Function.builder()
                .name("weight")
                .functionType(FunctionType.RERANK)
                .param("reranker", "weighted")
                .param("weights", "[0.1, 0.9]")
                .param("norm_score", "true")
                .build();

  
    
  
```

```javascript
import { FunctionType } from '@zilliz/milvus2-sdk-node';

const rerank = {
    name: "weight",
    input_field_names: [],
    function_type: FunctionType.RERANK,
    params: {
        reranker: "weighted",
        weights: [0.1, 0.9],
        norm_score: true
    }
};

  
    
  
```

```go
// Go

  
    
  
```

```bash
# Restful

  
    
  
```

å‚æ•°

æ˜¯å¦éœ€è¦ï¼Ÿ

è¯´æ˜

å€¼/ç¤ºä¾‹

`name`

æ˜¯

æ­¤åŠŸèƒ½çš„å”¯ä¸€æ ‡è¯†ç¬¦

`"weight"`

`input_field_names`

æ˜¯

è¦åº”ç”¨è¯¥å‡½æ•°çš„å‘é‡åœºåˆ—è¡¨ï¼ˆå¯¹äºåŠ æƒæ’åºå™¨å¿…é¡»ä¸ºç©ºï¼‰

\[\]

`function_type`

æ˜¯

è¦è°ƒç”¨çš„å‡½æ•°ç±»å‹ï¼›ä½¿ç”¨`RERANK` æŒ‡å®šé‡æ’ç­–ç•¥

`FunctionType.RERANK`

`params.reranker`

æ˜¯

æŒ‡å®šè¦ä½¿ç”¨çš„æ’åºæ–¹æ³•ã€‚

å¿…é¡»è®¾ç½®ä¸º`weighted` æ‰èƒ½ä½¿ç”¨åŠ æƒæ’åå™¨ã€‚

`"weighted"`

`params.weights`

æ˜¯

æ¯ä¸ªæœç´¢è·¯å¾„å¯¹åº”çš„æƒé‡æ•°ç»„ï¼›å€¼âˆˆ \[0,1\]ã€‚

æœ‰å…³è¯¦æƒ…ï¼Œè¯·å‚é˜…[åŠ æƒæ’åºå™¨æœºåˆ¶](/docs/zh/weighted-ranker.md#Mechanism-of-Weighted-Ranker)ã€‚

`[0.1, 0.9]`

`params.norm_score`

æ˜¯å¦

æ˜¯å¦åœ¨åŠ æƒå‰å¯¹åŸå§‹åˆ†æ•°è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼ˆä½¿ç”¨ arctanï¼‰ã€‚

è¯¦æƒ…è¯·å‚é˜…[åŠ æƒæ’åºå™¨æœºåˆ¶](/docs/zh/weighted-ranker.md#Mechanism-of-Weighted-Ranker)ã€‚

`True`

### åº”ç”¨äºæ··åˆæœç´¢

åŠ æƒæ’åå™¨æ˜¯ä¸“é—¨ä¸ºç»“åˆå¤šä¸ªå‘é‡åœºçš„æ··åˆæœç´¢æ“ä½œè€Œè®¾è®¡çš„ã€‚æ‰§è¡Œæ··åˆæœç´¢æ—¶ï¼Œå¿…é¡»ä¸ºæ¯æ¡æœç´¢è·¯å¾„æŒ‡å®šæƒé‡ï¼š

[Python](#python) [Java](#java) [NodeJS](#javascript) [Go](#go) [cURL](#bash)

```python
from pymilvus import MilvusClient, AnnSearchRequest

# Connect to Milvus server
milvus_client = MilvusClient(uri="http://localhost:19530")

# Assume you have a collection setup

# Define text vector search request
text_search = AnnSearchRequest(
    data=["modern dining table"],
    anns_field="text_vector",
    param={},
    limit=10
)

# Define image vector search request
image_search = AnnSearchRequest(
    data=[image_embedding],  # Image embedding vector
    anns_field="image_vector",
    param={},
    limit=10
)

# Apply Weighted Ranker to product hybrid search
# Text search has 0.8 weight, image search has 0.3 weight
hybrid_results = milvus_client.hybrid_search(
    collection_name,
    [text_search, image_search],  # Multiple search requests
    ranker=rerank,  # Apply the weighted ranker
    limit=10,
    output_fields=["product_name", "price", "category"]
)

  
    
  
```

```java
import io.milvus.v2.client.ConnectConfig;
import io.milvus.v2.client.MilvusClientV2;
import io.milvus.v2.service.vector.request.AnnSearchReq;
import io.milvus.v2.service.vector.request.HybridSearchReq;
import io.milvus.v2.service.vector.response.SearchResp;
import io.milvus.v2.service.vector.request.data.EmbeddedText;
import io.milvus.v2.service.vector.request.data.FloatVec;

MilvusClientV2 client = new MilvusClientV2(ConnectConfig.builder()
        .uri("http://localhost:19530")
        .build());
        
List<AnnSearchReq> searchRequests = new ArrayList<>();
searchRequests.add(AnnSearchReq.builder()
        .vectorFieldName("text_vector")
        .vectors(Collections.singletonList(new EmbeddedText("\"modern dining table\"")))
        .limit(10)
        .build());
searchRequests.add(AnnSearchReq.builder()
        .vectorFieldName("image_vector")
        .vectors(Collections.singletonList(new FloatVec(imageEmbedding)))
        .limit(10)
        .build());
        
HybridSearchReq hybridSearchReq = HybridSearchReq.builder()
                .collectionName(COLLECTION_NAME)
                .searchRequests(searchRequests)
                .ranker(ranker)
                .limit(10)
                .outputFields(Arrays.asList("product_name", "price", "category"))
                .build();
SearchResp searchResp = client.hybridSearch(hybridSearchReq);

  
    
  
```

```javascript
import { MilvusClient, FunctionType } from "@zilliz/milvus2-sdk-node";

const milvusClient = new MilvusClient({ address: "http://localhost:19530" });

const text_search = {
  data: ["modern dining table"],
  anns_field: "text_vector",
  param: {},
  limit: 10,
};

const image_search = {
  data: [image_embedding],
  anns_field: "image_vector",
  param: {},
  limit: 10,
};

const rerank = {
  name: "weight",
  input_field_names: [],
  function_type: FunctionType.RERANK,
  params: {
    reranker: "weighted",
    weights: [0.1, 0.9],
    norm_score: true,
  },
};

const search = await milvusClient.search({
  collection_name: collection_name,
  limit: 10,
  data: [text_search, image_search],
  rerank: rerank,
  output_fields = ["product_name", "price", "category"],
});

  
    
  
```

```go
// go

  
    
  
```

```bash
# restful

  
    
  
```

æœ‰å…³æ··åˆæœç´¢çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[å¤šå‘é‡æ··åˆæœç´¢](/docs/zh/multi-vector-search.md)ã€‚

ç¿»è¯‘è‡ª![DeepL](/_next/static/media/deepl.d32c6a10.png)

##### ç›®å½•

-   [åŠ æƒæ’åå™¨](#Weighted-Ranker)
-   [ä½•æ—¶ä½¿ç”¨åŠ æƒæ’åå™¨](#When-to-use-Weighted-Ranker)
-   [åŠ æƒæ’åºå™¨çš„æœºåˆ¶](#Mechanism-of-Weighted-Ranker)
-   [åŠ æƒæ’åºå™¨ç¤ºä¾‹](#Example-of-Weighted-Ranker)
-   [åŠ æƒæ’åå™¨çš„ä½¿ç”¨](#Usage-of-Weighted-Ranker)
-   [åˆ›å»ºåŠ æƒæ’åºå™¨](#Create-a-Weighted-Ranker)
-   [åº”ç”¨äºæ··åˆæœç´¢](#Apply-to-hybrid-search)

## æƒ³è¦æ›´å¿«ã€æ›´ç®€å•ã€æ›´å¥½ç”¨çš„ Milvus SaaSæœåŠ¡ ï¼Ÿ

Zilliz Cloudæ˜¯åŸºäºMilvusçš„å…¨æ‰˜ç®¡å‘é‡æ•°æ®åº“ï¼Œæ‹¥æœ‰æ›´é«˜æ€§èƒ½ï¼Œæ›´æ˜“æ‰©å±•ï¼Œä»¥åŠå“è¶Šæ€§ä»·æ¯”

[å…è´¹è¯•ç”¨ Zilliz Cloud](https://cloud.zilliz.com.cn/signup?utm_source=milvusio&utm_medium=referral&utm_campaign=milvus_right_card&utm_content=docs/zh/weighted-ranker.md)

##### åé¦ˆ

æ­¤é¡µå¯¹æ‚¨æ˜¯å¦æœ‰å¸®åŠ©?

Ask AI![](/inkeep/milvus-icon-white.png)